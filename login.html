<!doctype html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FarmazonGymApp â€” Login</title>
<link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
  <div class="header">
    <div class="logo">
      <div>
        <div class="brand">FarmazonGymApp</div>
        <div class="small">Logowanie / Rejestracja</div>
      </div>
    </div>
    <div class="small muted">Firebase Auth + Firestore</div>
  </div>

  <div class="card" id="authCard">
    <h2 style="margin:0 0 8px 0">Zaloguj siÄ™</h2>
    <div class="small muted">Po zalogowaniu zostaniesz przekierowany do widoku zaleÅ¼nego od roli (user / trainer).</div>

    <div class="row" style="margin-top:12px">
      <input id="email" placeholder="Email" autocomplete="email" />
    </div>
    <div class="row" style="margin-top:10px">
      <input id="pass" type="password" placeholder="HasÅ‚o" autocomplete="current-password" />
    </div>

    <div class="row" style="margin-top:12px;flex-wrap:wrap">
      <button id="btnLogin" class="button">Zaloguj</button>
      <button id="btnRegister" class="ghost">Zarejestruj</button>
      <button id="btnReset" class="ghost">Reset hasÅ‚a</button>
    </div>

    <div id="msg" class="small" style="margin-top:10px;min-height:18px"></div>
    <hr class="sep" />
    <div class="small muted">
      Tip: aby ustawiÄ‡ konto trenera, w konsoli Firebase â†’ Firestore â†’ users/{uid} ustaw <span class="badge">role = "trainer"</span>.
    </div>
  </div>

  <div class="footer">FarmazonGymApp â€” wersja TOP (vanilla)</div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="app.js"></script>
<script>
const msg = document.getElementById('msg');
const email = document.getElementById('email');
const pass = document.getElementById('pass');
const btnLogin = document.getElementById('btnLogin');
const btnRegister = document.getElementById('btnRegister');
const btnReset = document.getElementById('btnReset');

function show(m, ok=false){
  msg.textContent = m;
  msg.style.color = ok ? 'var(--ok)' : 'var(--muted)';
  setTimeout(()=>{ msg.textContent=''; msg.style.color='var(--muted)'; }, 4500);
}

btnRegister.addEventListener('click', async ()=>{
  try{
    const e = email.value.trim(); const p = pass.value;
    if(!e || !p) return show('Podaj email i hasÅ‚o');
    await window.appLib.register(e,p);
    show('âœ… Zarejestrowano. Zaloguj siÄ™.', true);
  }catch(err){ console.error(err); show(err.message || String(err)); }
});

btnLogin.addEventListener('click', async ()=>{
  try{
    const e = email.value.trim(); const p = pass.value;
    if(!e || !p) return show('Podaj email i hasÅ‚o');
    await window.appLib.login(e,p);
  }catch(err){ console.error(err); show(err.message || String(err)); }
});

btnReset.addEventListener('click', async ()=>{
  try{
    const e = email.value.trim();
    if(!e) return show('Wpisz email do resetu hasÅ‚a');
    await firebase.auth().sendPasswordResetEmail(e);
    show('ðŸ“© WysÅ‚ano email resetujÄ…cy hasÅ‚o.', true);
  }catch(err){ console.error(err); show(err.message || String(err)); }
});

window.appLib.auth.onAuthStateChanged(async user=>{
  if(!user) return;
  const role = await window.appLib.getUserRole(user.uid);
  if(role === 'trainer') window.location.href = 'trainer.html';
  else window.location.href = 'app.html';
});
</script>
</body>
</html>
